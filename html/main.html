<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title>Hello APP</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
</head>

<body>
    <label>Hello APP</label>
    <div id='sys-info'></div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript">
    apiready = function() {
      initJpush()
    };
    function initJpush(){
      var ajpush = api.require('ajpush');
      var param = {alias:'user1',tags:['user']};//别名，给指定的user1推送
      ajpush.bindAliasAndTags(param,function(ret) {
        switch (ret.statusCode) {
           case 0:
             resolve()
             break
           case 6001:
             reject({ msg: 'tag/alias无效的设置', code: 6001 })
             break
           case 6002:
             reject({ msg: '推送注册超时，请重试', code: 6002 })
             break
           default:
             reject({ msg: '请联系管理员', code: ret.statusCode })
         }
      });
      ajpush.init(function(ret) {
        alert('初始化成功')
        ajpush.setListener( function (ret){
          api.notification({
              vibrate: new Array(12).fill(1000),
              light: true,
              notify: {
                title: '您有一条新信息',
                content: ret.content,
                extra: ret.extra || {}
              }
            })
          });
      });
     api.addEventListener({
       name: 'noticeclicked'
     }, (ret) => {
       api.stopPlay()
       // do...
       alert('被点击了')
     })
    }
</script>

</html>
